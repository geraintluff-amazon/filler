<img src="pixels.png" id="pixels">
<canvas id="canvas" width="61" height="7"></canvas>
<textarea id="output" style="width: 90%; height: 10em;"></textarea>
<script>
	if (/reload/.test(location.hash)) {
		setTimeout(function () {
			location.reload();
		}, 2000);
	}

	var img = document.querySelector('#pixels');
	img.onload = function () {
		var canvas = document.querySelector('#canvas');
		
		var context = canvas.getContext('2d');
		context.drawImage(img, 0, 0);
		var imageData = context.getImageData(0, 0, canvas.width, canvas.height);
		
		var jsonResult = [];
		for (var y = 0; y < imageData.height; y++) {
			var row = [];
			for (var x = 0; x < imageData.width; x++) {
				var index = (x + y*imageData.width)*4;
				var value = 0;
				for (var i = 0; i < 3; i++) value += imageData.data[index + i];

				// quantise
				if (value > 700) {
					row.push(0);
				} else if (value > 620) {
					row.push(1);
				} else if (value > 490) {
					row.push(2);
				} else if (value > 300) {
					row.push(3);
				} else if (value > 150) {
					row.push(4);
				} else {
					row.push(value);
				}
			}
			jsonResult.push('[' + row + ']');
		}
		
		document.querySelector('#output').value = '[' + jsonResult.join(',\n') + ']';
	};
</script>